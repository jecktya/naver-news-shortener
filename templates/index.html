<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸°</title>
    <style>
        body { font-family:'Malgun Gothic',sans-serif; background:#f9f9f9; margin:40px; }
        form { margin-bottom:20px; }
        label, select, input[type=text], button { font-size:1em; }
        select, input[type=text] { padding:6px; border:1px solid #ccc; border-radius:4px; }
        button { padding:6px 12px; margin-left:8px; background:#4287f5; color:#fff; border:none; border-radius:4px; cursor:pointer; }
        button:hover { opacity:0.9; }
        table { width:100%; border-collapse:collapse; margin-top:10px; }
        th, td { border:1px solid #ddd; padding:8px; text-align:left; }
        th { background:#f2f2f2; }
        textarea { width:100%; height:120px; font-size:1em; padding:8px; border:1px solid #ccc; border-radius:4px; }
        hr { margin:24px 0; border:none; border-top:1px solid #eee; }
    </style>
    <script>
    // ì „ì²´ ì„ íƒ/í•´ì œ
    function checkAll(val) {
        document.querySelectorAll('input[name="article_check"]').forEach(e => e.checked = val);
        updateTextarea();
    }
    // ì²´í¬ ì‹œ í…ìŠ¤íŠ¸ì—ë¦¬ì•„ ì‹¤ì‹œê°„ ë°˜ì˜
    function updateTextarea() {
        let checked = [];
        document.querySelectorAll('input[name="article_check"]:checked').forEach(e => {
            checked.push(e.dataset.text);
        });
        document.getElementById('copy_area').value = checked.join('\n\n');
    }
    // ë„¤ì´ë²„ë¯¸ ë³€í™˜ (AJAX)
    async function convertNaverme() {
        let checked = [];
        document.querySelectorAll('input[name="article_check"]:checked').forEach(e => checked.push(e.value));
        const resp = await fetch('/naverme', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'selected_urls=' + JSON.stringify(checked)
        });
        const data = await resp.json();
        alert('ë„¤ì´ë²„ë¯¸ ë³€í™˜ ê²°ê³¼: ' + JSON.stringify(data.results));
    }
    </script>
</head>
<body>
    <h1>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸°</h1>
    <form method="post" action="/">
        <label>ğŸ—‚ï¸ ê²€ìƒ‰ ìœ í˜•:</label>
        <select name="search_mode">
            <option value="ì „ì²´" {% if search_mode == 'ì „ì²´' %}selected{% endif %}>ì „ì²´</option>
            <option value="ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" {% if search_mode == 'ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ' %}selected{% endif %}>ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ</option>
        </select>
        <br><br>
        <label>ğŸ” í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„):</label><br>
        <input type="text" name="keywords" style="width:400px;" value="{{ keyword_input or '' }}" placeholder="ì˜ˆ: ìœ¡êµ°, êµ­ë°©, ...">
        <button type="submit">ğŸ” ê²€ìƒ‰</button>
        <span style="color:gray; float:right;">ğŸ•’ í˜„ì¬ ì‹œê°: {{ now }}</span>
    </form>
    {% if msg %}
        <div style="color:blue; margin-bottom:14px;">{{ msg }}</div>
    {% endif %}
    {% if final_articles %}
        <hr>
        <button type="button" onclick="checkAll(true)">âœ… ì „ì²´ ì„ íƒ</button>
        <button type="button" onclick="checkAll(false)">âŒ ì „ì²´ í•´ì œ</button>
        <button type="button" onclick="convertNaverme()">ğŸ”— ë„¤ì´ë²„ë¯¸ ë³€í™˜</button>
        <br><br>
        <table>
            <tr>
                <th>ì„ íƒ</th><th>ì œëª©</th><th>ì–¸ë¡ ì‚¬</th><th>ì‹œê°„</th><th>í‚¤ì›Œë“œ</th>
            </tr>
            {% for art in final_articles %}
            <tr>
                <td>
                    <input type="checkbox" name="article_check" value="{{ art.url }}" data-text="â–  {{ art.title }} ({{ art.press }})\n{{ art.url }}" onclick="updateTextarea()" checked>
                </td>
                <td>{{ art.title }}</td>
                <td>{{ art.press }}</td>
                <td>{{ art.pubdate }}</td>
                <td>{{ art.matched | join(', ') }}</td>
            </tr>
            {% endfor %}
        </table>
        <br>
        <textarea id="copy_area" readonly>
{% for art in final_articles %}
â–  {{ art.title }} ({{ art.press }})
{{ art.url }}

{% endfor %}
        </textarea>
        <script>updateTextarea();</script>
    {% endif %}
</body>
</html>
