<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“° ë„¤ì´ë²„ ë‰´ìŠ¤ê²€ìƒ‰ê¸° + ë„¤ì´ë²„ë¯¸ ë³€í™˜</title>
    <style>
        body { font-family:'Malgun Gothic',sans-serif; background:#f9f9f9; margin:40px; }
        form { margin-bottom:20px; }
        label, select, input[type=text], button { font-size:1em; }
        select, input[type=text] { padding:6px; border:1px solid #ccc; border-radius:4px; }
        button { padding:6px 12px; margin-left:8px; background:#4287f5; color:#fff; border:none; border-radius:4px; cursor:pointer; }
        button:hover { opacity:0.9; }
        table { width:100%; border-collapse:collapse; margin-top:10px; }
        th, td { border:1px solid #ddd; padding:8px; text-align:left; }
        th { background:#f2f2f2; }
        textarea { width:100%; height:120px; font-size:1em; padding:8px; border:1px solid #ccc; border-radius:4px; }
        hr { margin:24px 0; border:none; border-top:1px solid #eee; }
    </style>
    <script>
    // ì „ì²´ì„ íƒ/í•´ì œ
    function toggleAll(checked) {
        let cbs = document.querySelectorAll('input[name="selected_urls"]');
        cbs.forEach(cb => cb.checked = checked);
        updateTextarea();
    }
    // textarea ìë™ ê°±ì‹ 
    function updateTextarea() {
        let cbs = document.querySelectorAll('input[name="selected_urls"]:checked');
        let arts = JSON.parse(document.getElementById("final_articles_json").value);
        let txts = [];
        cbs.forEach(cb => {
            let a = arts.find(x => x.url == cb.value);
            if (a) {
                txts.push(`â–  ${a.title} (${a.press})\n${a.url}`);
            }
        });
        document.getElementById("copy_area").value = txts.join('\n\n');
    }
    </script>
</head>
<body>
    <h1>ğŸ“° ë„¤ì´ë²„ ë‰´ìŠ¤ê²€ìƒ‰ê¸° + ë„¤ì´ë²„ë¯¸ ë³€í™˜</h1>
    <form method="post" action="/">
        <label>ğŸ—‚ï¸ ê²€ìƒ‰ ìœ í˜•:</label>
        <select name="search_mode">
            <option value="ì „ì²´" {% if search_mode == 'ì „ì²´' %}selected{% endif %}>ì „ì²´</option>
            <option value="ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" {% if search_mode == 'ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ' %}selected{% endif %}>ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ</option>
        </select>
        <label style="margin-left:20px;">ğŸ” í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„):</label>
        <input type="text" name="keywords" style="width:400px;" value="{{ keyword_input or '' }}" placeholder="ì˜ˆ: ìœ¡êµ°, êµ­ë°©, ì™¸êµ">
        <button type="submit">ğŸ” ê²€ìƒ‰</button>
    </form>

    <div style="color:gray; font-size:13px; margin-bottom:10px;">
        ğŸ•’ í˜„ì¬ ì‹œê°: {{ now }} (4ì‹œê°„ ì´ë‚´, 2ê°œ ì´ìƒ í‚¤ì›Œë“œ í¬í•¨ ê¸°ì‚¬ë§Œ)
    </div>
    {% if msg %}
    <div style="margin: 12px 0; color:#0d57a2;">{{ msg }}</div>
    {% endif %}

    {% if final_articles %}
    <hr>
    <form id="news_form" method="post" action="/naverme">
        <input type="hidden" name="keyword_input" value="{{ keyword_input }}">
        <input type="hidden" name="search_mode" value="{{ search_mode }}">
        <input type="hidden" id="final_articles_json" value='{{ final_articles|tojson|safe }}'>
        <table>
            <tr>
                <th><input type="checkbox" onclick="toggleAll(this.checked)">ì „ì²´</th>
                <th>ì œëª©</th>
                <th>ì–¸ë¡ ì‚¬</th>
                <th>í‚¤ì›Œë“œ</th>
                <th>ì‹œê°„</th>
                <th>ì›ë³¸</th>
            </tr>
            {% for art in final_articles %}
            <tr>
                <td>
                    <input type="checkbox" name="selected_urls" value="{{ art.url }}" checked onchange="updateTextarea()">
                </td>
                <td>{{ art.title }}</td>
                <td>{{ art.press }}</td>
                <td>
                    {{ art.matched_list | join(', ') }} ({{ art.matched_count }})
                </td>
                <td>{{ art.pubdate_str }}</td>
                <td><a href="{{ art.url }}" target="_blank">ê¸°ì‚¬</a></td>
            </tr>
            {% endfor %}
        </table>
        <div style="margin-top:12px;">
            <textarea id="copy_area" readonly onclick="this.select();"></textarea>
        </div>
        <button type="submit" style="margin-top:10px;">ğŸ”— ì„ íƒ ê¸°ì‚¬ ë„¤ì´ë²„ë¯¸ ë³€í™˜</button>
    </form>
    <script>
        // ì²« ë¡œë“œì‹œ ìë™ í…ìŠ¤íŠ¸ì—ë¦¬ì–´ ë°˜ì˜
        window.onload = function() { updateTextarea(); }
    </script>
    {% endif %}

    {% if naverme_map %}
        <hr>
        <h3>ë„¤ì´ë²„me ë³€í™˜ ê²°ê³¼</h3>
        <ul>
        {% for url, naverme in naverme_map.items() %}
            <li>
                <b><a href="{{ url }}" target="_blank">{{ url }}</a></b>
                <br>
                <span>â†’ <a href="{{ naverme }}" target="_blank">{{ naverme }}</a></span>
            </li>
        {% endfor %}
        </ul>
    {% endif %}

    {% if msg %}
        <div style="color: #a00; margin-top: 14px;">{{ msg }}</div>
    {% endif %}

    <p style="margin-top:30px;"><a href="/">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></p>
</body>
</html>
