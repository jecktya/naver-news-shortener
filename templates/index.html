<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ë„¤ì´ë²„ ë‰´ìŠ¤ê²€ìƒ‰ê¸° + ë‹¨ì¶•ì£¼ì†Œ</title>
</head>
<body>
<h1>ğŸ“° ë„¤ì´ë²„ ë‰´ìŠ¤ê²€ìƒ‰ê¸°</h1>
<form method="post">
    <label>ğŸ—‚ï¸ ê²€ìƒ‰ ìœ í˜• ì„ íƒ</label>
    <select name="search_mode">
        <option value="ì „ì²´" {% if search_mode == "ì „ì²´" %}selected{% endif %}>ì „ì²´</option>
        <option value="ë™ì˜ìƒë§Œ" {% if search_mode == "ë™ì˜ìƒë§Œ" %}selected{% endif %}>ë™ì˜ìƒë§Œ</option>
        <option value="ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" {% if search_mode == "ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" %}selected{% endif %}>ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ</option>
    </select>
    <br><br>
    <label>ğŸ” í‚¤ì›Œë“œ ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
    <input type="text" name="keywords" value="{{ keywords }}" style="width:400px;">
    <button type="submit">ğŸ” ë‰´ìŠ¤ ê²€ìƒ‰</button>
</form>
{% if articles %}
<hr>
<form id="copyForm">
<table border="1" cellpadding="5">
    <tr>
        <th>ì„ íƒ</th>
        <th>ì œëª©</th>
        <th>ì–¸ë¡ ì‚¬</th>
        <th>ì‹œê°„</th>
        <th>ì£¼ì†Œ(ë‹¨ì¶•)</th>
    </tr>
    {% for art in articles %}
    <tr>
        <td><input type="checkbox" name="select_article" value="{{ art.short_url }}"></td>
        <td>{{ art.title }}</td>
        <td>{{ art.press }}</td>
        <td>{{ art.pubdate.strftime('%Y-%m-%d %H:%M') }}</td>
        <td><a href="{{ art.short_url }}" target="_blank">{{ art.short_url }}</a></td>
    </tr>
    {% endfor %}
</table>
<br>
<button type="button" onclick="copySelected()">ğŸ“‹ ì„ íƒ ê¸°ì‚¬ ë³µì‚¬</button>
<button type="button" onclick="downloadSelected()">ğŸ“„ ì„ íƒ ë‹¤ìš´ë¡œë“œ(.txt)</button>
</form>
<script>
function copySelected() {
    let checks = document.querySelectorAll('input[name=select_article]:checked');
    let txts = [];
    checks.forEach(chk => { txts.push(chk.value); });
    if (txts.length === 0) {
        alert('ê¸°ì‚¬ ì„ íƒí•˜ì„¸ìš”!');
        return;
    }
    let t = document.createElement("textarea");
    t.value = txts.join("\\n");
    document.body.appendChild(t);
    t.select();
    document.execCommand('copy');
    document.body.removeChild(t);
    alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
}
function downloadSelected() {
    let checks = document.querySelectorAll('input[name=select_article]:checked');
    let txts = [];
    checks.forEach(chk => { txts.push(chk.value); });
    if (txts.length === 0) {
        alert('ê¸°ì‚¬ ì„ íƒí•˜ì„¸ìš”!');
        return;
    }
    let blob = new Blob([txts.join("\\n")], {type: "text/plain"});
    let link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = "news.txt";
    link.click();
}
</script>
{% endif %}
</body>
</html>
