<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‰´ìŠ¤ê²€ìƒ‰ê¸°</title>
    <style>
        textarea { width: 100%; min-height: 200px; }
        .article-item { margin-bottom: 10px; border-bottom:1px solid #eee; padding: 5px;}
        .btn { padding: 6px 10px; margin:2px; }
    </style>
</head>
<body>
    <h2>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸°</h2>
    <form method="post" action="/search">
        <input type="text" name="input_keywords" value="{{def_keywords}}">
        <select name="search_mode">
            <option value="ì „ì²´" {% if search_mode=="ì „ì²´" %}selected{% endif %}>ì „ì²´</option>
            <option value="ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" {% if search_mode=="ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" %}selected{% endif %}>ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ</option>
        </select>
        <button type="submit" class="btn">ğŸ” ë‰´ìŠ¤ ê²€ìƒ‰</button>
    </form>
    <br>
    {% if articles %}
    <form method="post" action="/shorten" id="copyForm">
        <button type="button" class="btn" onclick="selectAll(true)">âœ… ì „ì²´ ì„ íƒ</button>
        <button type="button" class="btn" onclick="selectAll(false)">âŒ ì „ì²´ í•´ì œ</button>
        <button type="button" class="btn" onclick="copySelected()">ğŸ“‹ ì„ íƒ ë³µì‚¬</button>
        <button type="submit" class="btn">ì£¼ì†Œë³€í™˜í•˜ê¸°</button>
        <div id="articleList">
        {% for a in articles %}
        <div class="article-item">
            <input type="checkbox" name="selected" value="{{a.url}}" data-title="{{a.title}}" data-press="{{a.press}}" checked>
            <b>{{a.title}}</b> ({{a.press}})
            <div style="color:gray;font-size:12px;">ğŸ•’ {{a.pubdate.strftime('%Y-%m-%d %H:%M')}} | í‚¤ì›Œë“œ: {{a.matched|join(', ')}}</div>
            <a href="{{a.url}}" target="_blank">[ê¸°ì‚¬ ë³´ê¸°]</a>
        </div>
        {% endfor %}
        </div>
        <input type="hidden" name="selected_keys" id="selected_keys">
        <input type="hidden" name="titles" id="titles">
        <input type="hidden" name="presses" id="presses">
        <textarea id="final_txt"></textarea>
    </form>
    <script>
        function updateTextarea() {
            let out = [], urls=[], titles=[], presses=[];
            document.querySelectorAll("input[name='selected']:checked").forEach(chk=>{
                let title = chk.dataset.title || chk.value;
                let press = chk.dataset.press || '';
                out.push("â–  " + title + " (" + press + ")\n" + chk.value);
                urls.push(chk.value);
                titles.push(title);
                presses.push(press);
            });
            document.getElementById('final_txt').value = out.join('\n\n');
            document.getElementById('selected_keys').value = urls.join('\n');
            document.getElementById('titles').value = titles.join('\n');
            document.getElementById('presses').value = presses.join('\n');
        }
        document.querySelectorAll("input[name='selected']").forEach(chk=>{
            chk.addEventListener('change', updateTextarea);
        });
        function selectAll(flag){
            document.querySelectorAll("input[name='selected']").forEach(chk=>{
                chk.checked=flag;
            });
            updateTextarea();
        }
        function copySelected() {
            updateTextarea();
            document.getElementById('final_txt').select();
            document.execCommand('copy');
            alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
        updateTextarea();
    </script>
    {% endif %}
</body>
</html>
