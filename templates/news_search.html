<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ë‰´ìŠ¤ê²€ìƒ‰ê¸°</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 40px; background: #f7f8fa; }
        .debug { background: #fffbe6; color: #666; padding: 6px 12px; border-radius: 8px; margin: 8px 0; font-size: 14px;}
        .card { background: #fff; padding: 18px; margin-bottom: 14px; border-radius: 14px; box-shadow: 0 2px 12px #ececec;}
        .btn { padding:5px 12px; font-size:15px; margin: 0 4px;}
        .small {font-size:13px;color:gray;}
        textarea { width:98%; font-size:15px; margin-top:10px; border-radius:8px; }
    </style>
    <script>
        // ì „ì²´ ì„ íƒ/í•´ì œ
        function selectAll(val) {
            document.querySelectorAll("input[name='selected']").forEach(chk=>{chk.checked=val;});
            updateFinalText();
        }
        // ë³µì‚¬ ê¸°ëŠ¥
        function copySelected() {
            let arr = [];
            document.querySelectorAll("input[name='selected']:checked").forEach(chk=>{
                let t = chk.dataset.title, p = chk.dataset.press, u = chk.dataset.short;
                arr.push(`â–  ${t} (${p})\n${u}`);
            });
            let txt = arr.join('\n\n');
            navigator.clipboard.writeText(txt);
            alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }
        function updateFinalText() {
            let arr = [];
            document.querySelectorAll("input[name='selected']:checked").forEach(chk=>{
                let t = chk.dataset.title, p = chk.dataset.press, u = chk.dataset.short;
                arr.push(`â–  ${t} (${p})\n${u}`);
            });
            document.getElementById('final_txt').value = arr.join('\n\n');
        }
    </script>
</head>
<body>
    <h2>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸° (FastAPI+Jinja2+Playwright)</h2>
    <form method="post">
        <input name="keywords" value="{{keywords}}" style="width:420px;" placeholder="í‚¤ì›Œë“œ(ì‰¼í‘œë¡œ êµ¬ë¶„)">
        <select name="search_mode">
            <option value="ì „ì²´" {% if search_mode=='ì „ì²´' %}selected{% endif %}>ì „ì²´</option>
            <option value="ë™ì˜ìƒë§Œ" {% if search_mode=='ë™ì˜ìƒë§Œ' %}selected{% endif %}>ë™ì˜ìƒë§Œ</option>
            <option value="ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" {% if search_mode=='ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ' %}selected{% endif %}>ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ</option>
        </select>
        <button type="submit" class="btn">ğŸ” ë‰´ìŠ¤ ê²€ìƒ‰</button>
    </form>
    {% if now %}<div class="small">ğŸ•’ í˜„ì¬ ì‹œê°: {{now}} (4ì‹œê°„ ì´ë‚´ ë‰´ìŠ¤ë§Œ ê²€ìƒ‰)</div>{% endif %}
    {% for msg in debug_msgs %}
        <div class="debug">{{msg}}</div>
    {% endfor %}
    {% if results %}
    <hr>
    <div>
        <button type="button" class="btn" onclick="selectAll(true)">âœ… ì „ì²´ ì„ íƒ</button>
        <button type="button" class="btn" onclick="selectAll(false)">âŒ ì „ì²´ í•´ì œ</button>
        <button type="button" class="btn" onclick="copySelected()">ğŸ“‹ ì„ íƒ ë³µì‚¬</button>
    </div>
    <form method="post" action="/download" onsubmit="return true;">
        {% for art in results %}
        <div class="card">
            <input type="checkbox" name="selected" value="{{art.url}}" checked 
                data-title="{{art.title}}" data-press="{{art.press}}" data-short="{{art.short_url}}" onclick="updateFinalText()">
            <b>{{art.title}}</b> ({{art.press}})
            <span class="small">ğŸ•’ {{art.pubdate.strftime("%Y-%m-%d %H:%M")}} | í‚¤ì›Œë“œ: {{art.matched|join(", ")}}</span>
            <div>
                <a href="{{art.short_url}}" target="_blank">{{art.short_url}}</a>
            </div>
            <div class="small">{{art.desc}}</div>
        </div>
        {% endfor %}
        <textarea id="final_txt" name="final_txt" rows="8" readonly>{{final_txt}}</textarea>
        <br>
        <button type="submit" class="btn">ğŸ“„ ì„ íƒ ë‹¤ìš´ë¡œë“œ</button>
    </form>
    <script>updateFinalText();</script>
    {% endif %}
</body>
</html>
