<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>📰 뉴스검색기</title>
    <style>body{font-family:'Malgun Gothic',sans-serif;}</style>
    <script>
      function selectAll(val){
        document.querySelectorAll('input[name="selected_urls"]').forEach(cb=>cb.checked=val);
        document.getElementById('form').submit(); // 실시간 반영 (or ajax)
      }
      function copyText(){
        let ta=document.getElementById("copy_area");
        ta.select();document.execCommand("copy");alert("복사완료");
      }
    </script>
</head>
<body>
<h2>📰 뉴스검색기 (FastAPI+Playwright)</h2>
<form method="post" id="form">
  <input type="text" name="keywords" value="{{keywords}}" style="width:90%">
  <input type="checkbox" name="checked_two_keywords" {% if checked_two_keywords %}checked{% endif %}> 2개 이상 키워드
  <input type="radio" name="search_mode" value="major" {% if search_mode == "major" %}checked{% endif %}>주요언론사만
  <input type="radio" name="search_mode" value="all" {% if search_mode == "all" %}checked{% endif %}>전체
  <button type="submit">🔍 뉴스 검색</button>
</form>
{% if final_results %}
  <button type="button" onclick="selectAll(true)">✅ 전체선택</button>
  <button type="button" onclick="selectAll(false)">❌ 전체해제</button>
  <button type="button" onclick="copyText()">📋 선택복사</button>
  <form method="post" action="/shorten">
    {% for n in final_results %}
      <input type="checkbox" name="selected_urls" value="{{n.url}}" checked> [{{n.press}}] {{n.title}} ({{n.kw_count}})
      <br>
    {% endfor %}
    <textarea id="copy_area" rows="10" style="width:100%">{{copy_area}}</textarea>
    <button type="submit">주소변환</button>
  </form>
{% endif %}
{% if failures %}
  <div style="color:red">
    {% for fail in failures %}
      {{fail}}<br>
    {% endfor %}
  </div>
{% endif %}
</body>
</html>
