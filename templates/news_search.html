<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸° (FastAPI+Playwright)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background:#fcfcfc; margin:40px;}
        input[type=text], textarea { font-size:1.1em; padding:4px; border:1px solid #ccc; border-radius:5px;}
        .msg { color:#4287f5; font-size:1.08em; margin-bottom:10px;}
        .checkbox { margin-right:5px; }
        .btn { font-size:1em; padding:3px 10px; border-radius:4px; border:1px solid #bbb; margin:2px 3px; background:#e7e7ef; cursor:pointer;}
        .btn-selected { background:#4287f5; color:#fff;}
        .copytxt { width:100%; min-height:120px; font-size:1.05em; margin-top:10px; }
        .small { font-size:0.95em; color:gray;}
        .nowrap {white-space: pre-line;}
    </style>
    <script>
        function selectAll(val) {
            let cbs = document.querySelectorAll('input[name="selected_urls"]');
            cbs.forEach(cb => cb.checked = val);
            document.getElementById('result_form').submit();
        }
        function updateCopyArea() {
            let cbs = document.querySelectorAll('input[name="selected_urls"]');
            let lines = [];
            for (let cb of cbs) {
                if (cb.checked) {
                    let idx = cb.getAttribute("data-idx");
                    lines.push(document.getElementById("copy_line_" + idx).value);
                }
            }
            document.getElementById("copy_area").value = lines.join("\n\n");
        }
        function copyText() {
            let ta = document.getElementById("copy_area");
            ta.select(); document.execCommand("copy");
            alert("ë³µì‚¬ ì™„ë£Œ!");
        }
    </script>
</head>
<body>
    <h2>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸° (FastAPI+Playwright)</h2>
    <form method="post">
        <label>í‚¤ì›Œë“œ ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„):</label><br>
        <input type="text" name="keywords" style="width:600px;" value="{{default_keywords}}" />
        <span class="small">ì˜ˆ: ìœ¡êµ°, êµ­ë°©, ì™¸êµ, ì‹ ë³‘, êµìœ¡ëŒ€ ... (ìˆ˜ì •/ì¶”ê°€/ì‚­ì œ ììœ )</span><br>
        <input type="checkbox" name="checked_two_keywords" value="on" {% if checked_two_keywords %}checked{% endif %}> 2ê°œ ì´ìƒ í‚¤ì›Œë“œ í¬í•¨ë§Œ ë³´ê¸°
        &nbsp;&nbsp;
        <label>ê²€ìƒ‰ ëŒ€ìƒ:</label>
        <input type="radio" name="search_mode" value="major" {% if search_mode == "major" %}checked{% endif %}>ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ
        <input type="radio" name="search_mode" value="all" {% if search_mode == "all" %}checked{% endif %}>ì „ì²´
        &nbsp;&nbsp;
        <button type="submit" class="btn">ğŸ” ë‰´ìŠ¤ ê²€ìƒ‰</button>
    </form>
    <div class="small">ğŸ•’ í˜„ì¬ ì‹œê°: {{now}} (4ì‹œê°„ ì´ë‚´ ë‰´ìŠ¤ë§Œ ê²€ìƒ‰)</div>
    {% if msg %}
    <div class="msg">{{msg}}</div>
    {% endif %}

    {% if final_results %}
    <form method="post" action="/shorten" id="result_form">
        <input type="hidden" name="keywords" value="{{default_keywords}}">
        <input type="hidden" name="checked_two_keywords" value="{{'on' if checked_two_keywords else ''}}">
        <input type="hidden" name="search_mode" value="{{search_mode}}">
        <div>
            <button type="button" class="btn" onclick="selectAll(true)">âœ… ì „ì²´ ì„ íƒ</button>
            <button type="button" class="btn" onclick="selectAll(false)">âŒ ì „ì²´ í•´ì œ</button>
            <button type="button" class="btn" onclick="copyText()">ğŸ“‹ ì„ íƒ ë³µì‚¬</button>
        </div>
        <ul>
            {% for r in final_results %}
            <li style="margin-bottom:10px;">
                <input type="checkbox" name="selected_urls" value="{{r.url}}" class="checkbox" data-idx="{{loop.index0}}" checked onchange="updateCopyArea()">
                <span>â–  {{r.title}} ({{r.press}})
                {% if r.matched_str %}<span class="small">í‚¤ì›Œë“œ: {{r.matched_str}}</span>{% endif %}
                <br><a href="{{r.url}}" target="_blank">{{r.url}}</a>
                </span>
                <input type="hidden" id="copy_line_{{loop.index0}}" value="â–  {{r.title}} ({{r.press}})\n{{r.url}}">
            </li>
            {% endfor %}
        </ul>
        <textarea name="copy_text" id="copy_area" class="copytxt nowrap" readonly>
{% for r in final_results %}â–  {{r.title}} ({{r.press}})
{{r.url}}
{% if not loop.last %}

{% endif %}{% endfor %}
        </textarea>
        <div>
            <button type="submit" class="btn">ğŸ”— ì„ íƒ ì£¼ì†Œ ë‹¨ì¶•</button>
        </div>
    </form>
    {% endif %}

    {% if copy_text and not final_results %}
    <form method="post" action="/shorten">
        <input type="hidden" name="keywords" value="{{default_keywords}}">
        <input type="hidden" name="checked_two_keywords" value="{{'on' if checked_two_keywords
