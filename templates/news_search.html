<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸°</title>
    <style>
        body { font-family: "ë§‘ì€ ê³ ë”•", "Malgun Gothic", Arial, sans-serif; margin:30px;}
        .btn { margin:3px; padding: 6px 12px; border-radius:6px; border:1px solid #ddd; background:#f3f3f3; cursor:pointer; }
        .article-block { border-bottom:1px solid #eee; margin:10px 0; padding:10px 0; }
        .gray { color:gray; font-size:13px;}
        .textarea { width:100%; min-height:150px;}
    </style>
</head>
<body>
    <h2>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸°</h2>
    <form method="post" action="/search">
        <label>ğŸ” í‚¤ì›Œë“œ ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„):</label>
        <input type="text" name="keywords" value="{{keywords}}">
        <label>
            <input type="radio" name="search_mode" value="ì „ì²´" {% if search_mode=="ì „ì²´" %}checked{% endif %}> ì „ì²´
        </label>
        <label>
            <input type="radio" name="search_mode" value="ë™ì˜ìƒë§Œ" {% if search_mode=="ë™ì˜ìƒë§Œ" %}checked{% endif %}> ë™ì˜ìƒë§Œ
        </label>
        <label>
            <input type="radio" name="search_mode" value="ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" {% if search_mode=="ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ" %}checked{% endif %}> ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ
        </label>
        <button class="btn" type="submit">ğŸ” ë‰´ìŠ¤ ê²€ìƒ‰</button>
        <span class="gray">ğŸ•’ í˜„ì¬ ì‹œê°: {{now}}</span>
    </form>
    {% if debug_msgs %}
        <div style="color:tomato;">
            {% for msg in debug_msgs %}
                <div>{{msg}}</div>
            {% endfor %}
        </div>
    {% endif %}
    <form id="shorten-form" method="post" action="/shorten">
        <input type="hidden" id="shorten_urls" name="urls">
        <input type="hidden" id="shorten_presses" name="presses">
        <input type="hidden" name="keywords" value="{{keywords}}">
        <input type="hidden" name="search_mode" value="{{search_mode}}">
        <div>
            <button type="button" class="btn" onclick="selectAll(true)">âœ… ì „ì²´ ì„ íƒ</button>
            <button type="button" class="btn" onclick="selectAll(false)">âŒ ì „ì²´ í•´ì œ</button>
            <button type="submit" class="btn">ğŸ“‘ ì£¼ì†Œ ìš”ì•½í•˜ê¸°</button>
        </div>
        {% for a in results %}
        <div class="article-block">
            <label>
                <input type="checkbox" name="selected" value="{{a.url}}" data-press="{{a.press}}" checked>
                <b>{{a.title}}</b> <span class="gray">({{a.press}})</span>
            </label>
            <div class="gray">ğŸ•’ {{a.pubdate.strftime('%Y-%m-%d %H:%M')}} | í‚¤ì›Œë“œ: {{a.matched|join(', ')}}</div>
            <a href="{{a.url}}" target="_blank">ğŸ“ ê¸°ì‚¬ ë°”ë¡œë³´ê¸°</a>
        </div>
        {% endfor %}
        <div>
            <textarea class="textarea" id="final_txt" readonly placeholder="ìµœì¢… ê²°ê³¼">{{final_txt}}</textarea>
        </div>
        {% if short_urls %}
            <h3>ë‹¨ì¶•ì£¼ì†Œ ê²°ê³¼</h3>
            <textarea rows="8" style="width:100%;">{{short_urls|join('\n')}}</textarea>
        {% endif %}
    </form>
    <script>
        function selectAll(flag){
            document.querySelectorAll("input[name='selected']").forEach(chk=>chk.checked=flag);
        }
        document.getElementById("shorten-form").onsubmit = function() {
            let urls = [];
            let presses = [];
            document.querySelectorAll("input[name='selected']:checked").forEach(chk=>{
                urls.push(chk.value);
                presses.push(chk.dataset.press);
            });
            document.getElementById('shorten_urls').value = urls.join(',');
            document.getElementById('shorten_presses').value = presses.join(',');
            return true;
        }
    </script>
</body>
</html>
