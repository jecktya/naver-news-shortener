<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸° (FastAPI+Playwright)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background:#fcfcfc; margin:40px;}
        input[type=text], textarea { font-size:1.1em; padding:4px; border:1px solid #ccc; border-radius:5px;}
        .msg { color:#4287f5; font-size:1.08em; margin-bottom:10px;}
        .checkbox { margin-right:5px; }
        .btn { font-size:1em; padding:3px 10px; border-radius:4px; border:1px solid #bbb; margin:2px 3px; background:#e7e7ef; cursor:pointer;}
        .btn-selected { background:#4287f5; color:#fff;}
        .copytxt { width:100%; min-height:120px; font-size:1.05em; margin-top:10px; }
        .small { font-size:0.95em; color:gray;}
        .failbox {color:#b00; font-size:0.97em; margin-top:8px;}
        .keyword-badge {margin-right:4px; padding:2px 6px; background:#eee; border-radius:4px; font-size:0.96em;}
    </style>
    <script>
    // ì „ì²´ ì„ íƒ/í•´ì œ, ì„ íƒ ë³µì‚¬ js
    function selectAll(val) {
        let cbs = document.querySelectorAll('input[name="selected_urls"]');
        cbs.forEach(cb => cb.checked = val);
        updateCopyArea();
    }
    function updateCopyArea() {
        let cbs = document.querySelectorAll('input[name="selected_urls"]:checked');
        let list = [];
        cbs.forEach(cb => {
            let idx = cb.value;
            let ta = document.getElementById("ta_" + idx);
            if (ta) list.push(ta.value);
        });
        document.getElementById("copy_area").value = list.join("\n\n");
    }
    function copyText() {
        let ta = document.getElementById("copy_area");
        ta.select(); document.execCommand("copy");
        alert("ë³µì‚¬ ì™„ë£Œ!");
    }
    </script>
</head>
<body>
    <h2>ğŸ“° ë‰´ìŠ¤ê²€ìƒ‰ê¸° (FastAPI+Playwright)</h2>
    <form method="post">
        <label>í‚¤ì›Œë“œ ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„):</label><br>
        <input type="text" name="keywords" style="width:95%;" value="{{ keyword_input or default_keywords }}" />
        <span class="small">ì˜ˆ: ìœ¡êµ°, êµ­ë°©, ì™¸êµ, ì‹ ë³‘, êµìœ¡ëŒ€ ... (ìˆ˜ì •/ì¶”ê°€/ì‚­ì œ ììœ )</span><br>
        <input type="checkbox" name="checked_two_keywords" value="on" {% if checked_two_keywords %}checked{% endif %}> 2ê°œ ì´ìƒ í‚¤ì›Œë“œ í¬í•¨ë§Œ ë³´ê¸°
        &nbsp;&nbsp;
        <label>ê²€ìƒ‰ ëŒ€ìƒ:</label>
        <input type="radio" name="search_mode" value="major" {% if search_mode == "major" %}checked{% endif %}>ì£¼ìš”ì–¸ë¡ ì‚¬ë§Œ
        <input type="radio" name="search_mode" value="all" {% if search_mode == "all" %}checked{% endif %}>ì „ì²´
        <input type="checkbox" name="video_only" value="on" {% if video_only %}checked{% endif %}> ë™ì˜ìƒë§Œ
        &nbsp;&nbsp;
        <button type="submit" class="btn">ğŸ” ë‰´ìŠ¤ ê²€ìƒ‰</button>
    </form>
    {% if msg %}
    <div class="msg">{{msg}}</div>
    {% endif %}
    {% if final_results %}
    <div>
        <div style="margin-top:10px;">
            <button type="button" class="btn" onclick="selectAll(true)">âœ… ì „ì²´ ì„ íƒ</button>
            <button type="button" class="btn" onclick="selectAll(false)">âŒ ì „ì²´ í•´ì œ</button>
        </div>
        <form method="post" action="/shorten">
            <input type="hidden" name="keywords" value="{{ keyword_input }}">
            <input type="hidden" name="checked_two_keywords" value="{{'on' if checked_two_keywords else ''}}">
            <input type="hidden" name="search_mode" value="{{ search_mode }}">
            <input type="hidden" name="video_only" value="{{'on' if video_only else ''}}">
            {% for idx, art in enumerate(final_results) %}
                <div style="margin-top:15px;">
                    <input type="checkbox" name="selected_urls" value="{{idx}}" class="checkbox" checked onclick="updateCopyArea()">
                    <span>â–  <b>{{art.title}}</b> ({{art.press}})</span>
                    <span class="small">[{{art.pubdate}}]</span>
                    <div style="color:gray; margin:2px 0 2px 0; font-size:0.97em;">
                        í‚¤ì›Œë“œ: 
                        {% for kw, cnt in art.keywords %}
                          <span class="keyword-badge">{{kw}}{% if cnt>1 %}({{cnt}}){% endif %}</span>
                        {% endfor %}
                    </div>
                    <a href="{{art.url}}" target="_blank">[ê¸°ì‚¬ë³´ê¸°]</a>
                    <textarea id="ta_{{idx}}" style="display:none;">â–  {{art.title}} ({{art.press}})
{{art.url}}</textarea>
                </div>
            {% endfor %}
            <textarea id="copy_area" class="copytxt" readonly onclick="this.select()">{% for idx, art in enumerate(final_results) %}
â–  {{art.title}} ({{art.press}})
{{art.url}}

{% endfor %}</textarea>
            <button type="button" class="btn" onclick="copyText()">ğŸ“‹ ì„ íƒ ë³µì‚¬</button>
            <button type="submit" class="btn">ğŸ”— ì„ íƒ ê¸°ì‚¬ ì£¼ì†Œ ë‹¨ì¶•ë³€í™˜</button>
        </form>
    </div>
    {% endif %}
    {% if shortened %}
    <div style="margin:15px 0 5px 0; color:green;">ë‹¨ì¶•ì£¼ì†Œ ë³€í™˜ ì™„ë£Œ!</div>
    <textarea class="copytxt" readonly onclick="this.select()">{{shortened}}</textarea>
    {% endif %}
    {% if shorten_fail %}
    <div class="failbox">
      <b>ë‹¨ì¶•ì£¼ì†Œ ë³€í™˜ ì‹¤íŒ¨ ëª©ë¡:</b><br>
      {% for f in shorten_fail %}
        {{f}}<br>
      {% endfor %}
    </div>
    {% endif %}
</body>
</html>
